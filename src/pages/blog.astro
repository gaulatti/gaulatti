---
import { type MediumPost, mediumPosts } from '../data/mediumPosts';
import Layout from '../layouts/Layout.astro';
import { Clock } from '@lucide/astro';

// Convert date strings to Date objects and sort posts
const posts = mediumPosts
  .map(post => ({ ...post, pubDate: new Date(post.pubDate) }))
  .sort((a, b) => b.pubDate.valueOf() - a.pubDate.valueOf());

// Get all unique tags
const allTags = [...new Set(posts.flatMap((post) => post.tags))].sort();

// Get the active tag from URL params
const activeTag = Astro.url.searchParams.get('tag');
const filteredPosts = activeTag ? posts.filter((post) => post.tags.includes(activeTag)) : posts;

const title = 'Blog â€” Gaulatti';
const description = 'Thoughts on software engineering, music composition, and digital storytelling.';
---

<Layout title={title} description={description}>
  <main class='pt-32 pb-24'>
    <div class='container'>
      <div class='max-w-4xl mx-auto'>
        <h1 class='text-5xl md:text-6xl font-bold mb-8 tracking-tight'>Blog</h1>
        <p class='text-xl text-gray-600 mb-12 max-w-2xl'>
          Exploring the intersection of technology, music, and storytelling. Deep dives into creative projects and technical challenges.
        </p>

        <!-- Tags Navigation -->
        <nav class='mb-16 overflow-x-auto'>
          <div class='flex gap-2 flex-wrap'>
            <a
              href='/blog'
              class:list={['px-3 py-1 rounded-sm text-sm transition-colors', !activeTag ? 'bg-black text-white' : 'bg-gray-100 hover:bg-gray-200']}
            >
              All Posts
            </a>
            {
              allTags.map((tagName) => (
                <a
                  href={`/blog?tag=${tagName}`}
                  class:list={[
                    'px-3 py-1 rounded-sm text-sm transition-colors',
                    activeTag === tagName ? 'bg-black text-white' : 'bg-gray-100 hover:bg-gray-200',
                  ]}
                >
                  {tagName}
                </a>
              ))
            }
          </div>
        </nav>

        <div class='space-y-16'>
          {
            filteredPosts.map((post) => (
              <article class='group'>
                <a href={post.link} target="_blank" rel="noopener noreferrer" class='block'>
                  <div class='space-y-4'>
                    <h2 class='text-3xl font-bold group-hover:text-accent-blue transition-colors'>{post.title}</h2>
                    <p class='text-gray-600'>{post.description}</p>
                    <div class='flex items-center gap-6'>
                      <time class='text-sm text-gray-500'>
                        {post.pubDate.toLocaleDateString('en-US', {
                          year: 'numeric',
                          month: 'long',
                          day: 'numeric',
                        })}
                      </time>
                      <div class='flex items-center gap-1 text-sm text-gray-500'>
                        <Clock class='w-4 h-4' />
                        <span>{post.readingTime}</span>
                      </div>
                      <div class='flex gap-2'>
                        {post.tags.map((tag) => (
                          <span class='text-sm px-2 py-1 bg-gray-100 rounded-sm'>{tag}</span>
                        ))}
                      </div>
                    </div>
                  </div>
                </a>
              </article>
            ))
          }
        </div>

        {
          filteredPosts.length === 0 && (
            <div class='text-center py-16'>
              <p class='text-xl text-gray-600'>No posts found for this tag.</p>
              <a href='/blog' class='text-accent-blue hover:underline mt-4 inline-block'>
                View all posts
              </a>
            </div>
          )
        }
      </div>
    </div>
  </main>
</Layout>
